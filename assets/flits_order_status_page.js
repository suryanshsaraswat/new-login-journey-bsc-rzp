
/****PLEASE DON'T MAKE CHANGES IN THIS FILE IT'S AFFECT THE CODE IF YOU NEED ANY HELP PLEASE CONTACT TO FLITS TEAM support@getflits.com ****/
(function(Flits){var orderStatusPage=Flits.orderStatusPage=function(){Flits.orderStatusPage.settings={};var settings={orderDate:Shopify.checkout.updated_at,storeCredit:{REMOVE_SECTION:1,ONLY_EARN_MARKETING_TEXT:2,CURRENT_CREDIT_WITH_SPENT_MARKETING_TEXT:3,referenceElement:Flits('.section__content .content-box:eq(0)'),sectionElement:Flits("#shopify-section-flits_order_status_page .flits-store-credit-box"),extraData:{},initialCallDelay:2*1000,responseData:null,noOfTimesRecall:1,noMoreRecallAfter:6*60,recallDelay:10*1000,checkExtraCondition:function(){return false},totalEarnedCreditOnOrderText:Flits.t('Flits.locals.order_status_page.total_earned_credit_on_order','Congratulations! You have earned {{ credit }} credit on this purchase.'),currentCreditBalanceText:Flits.t('Flits.locals.order_status_page.total_credit_balance','Your total credit balance is {{ credit }}.'),shopMoreToEarnCreditText:Flits.t('Flits.locals.order_status_page.shop_more_to_earn_credit_html','Want to earn more credits and save big bucks? Then dive into our collection and shop more!'),shopMoreToSpentCreditText:Flits.t('Flits.locals.order_status_page.shop_more_to_spent_credit_html','Still have credits left? Shop more to utilise them all.')}};settings=Flits.extend(Flits.orderStatusPage.settings,settings);Flits.dispatchEvent('Flits:orderStatusPage:settings:Loaded',{settings:settings});Flits.scOrderStatusAjaxRecall=function(){var scResponseData=Flits.orderStatusPage.settings.storeCredit.responseData;var currentDate=new Date;var orderDate=Flits.orderStatusPage.settings.orderDate;if(Flits.timeDiffer({date1:currentDate,date2:orderDate,type:'minute'})<=Flits.orderStatusPage.settings.storeCredit.noMoreRecallAfter){if(scResponseData.recall){setTimeout((function(){Flits.orderStatusPage.settings.storeCredit.noOfTimesRecall++;Flits.orderStatusPageServices.settings.storeCreditService();return}),Flits.orderStatusPage.settings.storeCredit.recallDelay);return true}}return false};Flits.isSpentRuleOn=function(){return Flits.orderStatusPage.settings.storeCredit.responseData.isOrderSpentRuleOn};Flits.isEarningRuleOn=function(){return Flits.orderStatusPage.settings.storeCredit.responseData.isOrderEarningRuleOn};Flits.setCreditSection=function(action){var scSectionElement=Flits.orderStatusPage.settings.storeCredit.sectionElement;var currentCreditBalance=Flits.orderStatusPage.settings.storeCredit.responseData.currentCreditBalance;switch(action){case Flits.orderStatusPage.settings.storeCredit.REMOVE_SECTION:scSectionElement.remove();break;case Flits.orderStatusPage.settings.storeCredit.ONLY_EARN_MARKETING_TEXT:var shopMoreToEarnCreditText=Flits.orderStatusPage.settings.storeCredit.shopMoreToEarnCreditText;scSectionElement.find('.shop-more-to-earn-credit').html(shopMoreToEarnCreditText);scSectionElement.find('.total-earned-credit-on-order,.earned-credit-ul,.current-credit-balance,.shop-more-to-spent-credit').remove();Flits.showCreditSection(scSectionElement);break;case Flits.orderStatusPage.settings.storeCredit.CURRENT_CREDIT_WITH_SPENT_MARKETING_TEXT:var currentCreditBalanceText=Flits.orderStatusPage.settings.storeCredit.currentCreditBalanceText;var shopMoreToSpentCreditText=Flits.orderStatusPage.settings.storeCredit.shopMoreToSpentCreditText;currentCreditBalance=Flits.formatMoney(Math.abs(currentCreditBalance),Flits.money_format);scSectionElement.find('.current-credit-balance').html(currentCreditBalanceText.replace('{{ credit }}',currentCreditBalance));scSectionElement.find('.shop-more-to-spent-credit').html(shopMoreToSpentCreditText);scSectionElement.find('.total-earned-credit-on-order,.earned-credit-ul,.shop-more-to-earn-credit').remove();Flits.showCreditSection(scSectionElement);break;default:break}};Flits.setOrderCredit=function(){var scSectionElement=Flits.orderStatusPage.settings.storeCredit.sectionElement;var scResponseData=Flits.orderStatusPage.settings.storeCredit.responseData;if(scResponseData.isLastOrder&&scResponseData.earnedCreditOnOrder&&scResponseData.earnedCreditOnOrder.credit>0){var earnedCreditOnOrder=scResponseData.earnedCreditOnOrder.credit;var totalEarnedCreditOnOrder=Flits.formatMoney(Math.abs(earnedCreditOnOrder),Flits.money_format);var totalEarnedCreditOnOrderText=Flits.orderStatusPage.settings.storeCredit.totalEarnedCreditOnOrderText;scSectionElement.find('.total-earned-credit-on-order').html(totalEarnedCreditOnOrderText.replace('{{ credit }}',totalEarnedCreditOnOrder));if(scResponseData.earnedCreditOnOrder.creditLogs.length>1){var productTagCreditfound=false;var productTagRuleModuleOn='';var earnedCreditOnProductTag=0;var productTagCreditText='';var productTagSpan=Flits('<span/>');Flits.each(scResponseData.earnedCreditOnOrder.creditLogs,(function(index,creditLog){var ruleModuleOn=creditLog.module_on;switch(ruleModuleOn){case'order_number':var earnedCreditText=Flits.t('Flits.locals.order_status_page.earned_credit_on_'+ruleModuleOn,'You earned {{ credit }} credit for this order.');var earnedCredit=Flits.formatMoney(Math.abs(creditLog.credits),Flits.money_format);earnedCreditText=earnedCreditText.replace('{{ credit }}',earnedCredit);scSectionElement.find('.earned-credit-on-'+ruleModuleOn).html(earnedCreditText);break;case'product_tag':productTagRuleModuleOn=ruleModuleOn;productTagCreditfound=true;productTagCreditText=Flits.t('Flits.locals.order_status_page.earned_credit_on_'+ruleModuleOn,'You earned {{ credit }} credit by purchasing from {{ tag }} collection.');earnedCreditOnProductTag+=parseFloat(creditLog.credits);if(creditLog.tags){Flits(creditLog.tags).each((function(index,item){let productTagAnchor=Flits('<a href="/search?q='+item+'" target="_blank" class="flits-link">'+item+'</a>');if(productTagSpan.text()!=''){productTagSpan.append(', ')}productTagSpan.append(productTagAnchor)}))}break;default:break}}));if(productTagCreditfound){var earnedCredit=Flits.formatMoney(Math.abs(earnedCreditOnProductTag),Flits.money_format);var earnedCreditText=productTagCreditText.replace('{{ credit }}',earnedCredit).replace('{{ tag }}',productTagSpan.html());scSectionElement.find('.earned-credit-on-'+productTagRuleModuleOn).html(earnedCreditText);scSectionElement.find('.earned-credit-ul').show()}}else{scSectionElement.find('.earned-credit-ul').remove()}}else{scSectionElement.find('.total-earned-credit-on-order,.earned-credit-ul').remove()}};Flits.showCreditSection=function(scSectionElement){scSectionElement.find('.flits-skeleton-row').fadeOut(200,(function(){scSectionElement.find('.flits-order-credit-row').fadeIn(100,(function(){Flits.dispatchEvent('Flits:orderStatusPage:storeCredit:AfterDataBind')}))}))};Flits(document).on('Flits:orderStatusPage:storeCredit:AjaxSuccessful',(function(event){var scResponseData=Flits.orderStatusPage.settings.storeCredit.responseData=event.detail.resp;var scSectionElement=Flits.orderStatusPage.settings.storeCredit.sectionElement;if(scResponseData.status){if(Flits.scOrderStatusAjaxRecall()){return}if(!Flits.isSpentRuleOn()){return Flits.setCreditSection(Flits.orderStatusPage.settings.storeCredit.REMOVE_SECTION)}var currentCreditBalance=scResponseData.currentCreditBalance;if(!Flits.isEarningRuleOn()&&currentCreditBalance<=0){return Flits.setCreditSection(Flits.orderStatusPage.settings.storeCredit.REMOVE_SECTION)}Flits.dispatchEvent('Flits:orderStatusPage:storeCredit:BeforeDataBind');if(Flits.isEarningRuleOn()){if(currentCreditBalance<=0){return Flits.setCreditSection(Flits.orderStatusPage.settings.storeCredit.ONLY_EARN_MARKETING_TEXT)}}else{return Flits.setCreditSection(Flits.orderStatusPage.settings.storeCredit.CURRENT_CREDIT_WITH_SPENT_MARKETING_TEXT)}if(Flits.orderStatusPage.settings.storeCredit.checkExtraCondition()){return}if(!scResponseData.isOrderCancelled){Flits.setOrderCredit()}if(currentCreditBalance>0){currentCreditBalance=Flits.formatMoney(Math.abs(currentCreditBalance),Flits.money_format);var currentCreditBalanceText=Flits.orderStatusPage.settings.storeCredit.currentCreditBalanceText;scSectionElement.find('.current-credit-balance').html(currentCreditBalanceText.replace('{{ credit }}',currentCreditBalance))}else{scSectionElement.find('.earned-credit-ul,.current-credit-balance').remove()}var shopMoreToEarnCreditText=Flits.orderStatusPage.settings.storeCredit.shopMoreToEarnCreditText;scSectionElement.find('.shop-more-to-earn-credit').html(shopMoreToEarnCreditText);scSectionElement.find('.shop-more-to-spent-credit').remove();Flits.showCreditSection(scSectionElement)}else{if(scResponseData.errorCode==2){if(Flits.scOrderStatusAjaxRecall()){return}}scSectionElement.remove()}}));var scSectionElement=Flits.orderStatusPage.settings.storeCredit.sectionElement;if(Flits.Metafields.ORDER_STATUS_PAGE.isStoreCreditEnable){var scReferenceElement=Flits.orderStatusPage.settings.storeCredit.referenceElement;scReferenceElement.after(scSectionElement);scSectionElement.show();setTimeout((function(){Flits.orderStatusPageServices.settings.storeCreditService();return}),Flits.orderStatusPage.settings.storeCredit.initialCallDelay)}else{scSectionElement.remove()}};Flits.extend({orderStatusPageServices:function(){Flits.orderStatusPageServices.settings={};var settings={storeCreditService:null};settings=Flits.extend(Flits.orderStatusPageServices.settings,settings);var customerId=Shopify.checkout.customer_id;var orderId=Shopify.checkout.order_id;var getOrderCreditUrl=Flits.base_url+"/"+customerId+"/"+orderId+"/get_credit";var encodedData=Flits.encodeData(customerId);if(encodedData.encodedValue){Flits.customerHash=Flits.partialCustomerHash+encodedData.encodedValue}Flits.orderStatusPageServices.settings.storeCreditService=function(callBack){Flits.ajax({method:"GET",url:getOrderCreditUrl,data:{noOfTimesRecall:Flits.orderStatusPage.settings.storeCredit.noOfTimesRecall,customer_hash:Flits.customerHash,token:Flits.token,customerHashKey:encodedData['randomString'],orderDate:Flits.orderStatusPage.settings.orderDate,extraData:Flits.orderStatusPage.settings.storeCredit.extraData}}).done((function(resp){setTimeout((function(){Flits.dispatchEvent('Flits:orderStatusPage:storeCredit:AjaxSuccessful',{resp:resp})}),0)}))};Flits.dispatchEvent('Flits:orderStatusPage:services:Loaded',{settings:settings})},randomString:function(length){var possible='abcdefghijklmnopqrstuvwxyz';var text='';for(var i=0;i<length;i++){text+=possible.charAt(Math.floor(Math.random()*possible.length))}return text},encodeData:function(data){data=data.toString();var randomString=Flits.randomString(10);var chars=randomString.split("");var oddOnes=[];var evenOnes=[];for(var i=0;i<data.length;i++){i%2==0?evenOnes.push(data[i]):oddOnes.push(data[i])}data=evenOnes.join("")+oddOnes.join("");return{'encodedValue':data.replace(/[0123456789]/g,(m=>chars[m])),'randomString':randomString}}});if(Flits.Metafields.ORDER_STATUS_PAGE){Flits.orderStatusPageServices();Flits.orderStatusPage()}})(Flits);
